<!DOCTYPE html>
<html>
<head>
	<title>ESP-MONITOR - Configuration</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="icon" href="data:,">
	<link rel="stylesheet" type="text/css" href="style.css">
	<script>
		function loadXMLDoc() {
		  var xmlhttp = new XMLHttpRequest();
		  xmlhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
					loadData(this);
			}
		  };
		  xmlhttp.open("GET", "test.xml" , true);
		  xmlhttp.send();
		}

		function loadData(xml) {
		  var xmlDoc = xml.responseXML;
		  document.getElementById("f_version").innerHTML = xmlDoc.getElementsByTagName("f_version")[0].childNodes[0].nodeValue;
		  document.getElementById("h_version").innerHTML = xmlDoc.getElementsByTagName("h_version")[0].childNodes[0].nodeValue;
		  document.getElementById("sensor_type").innerHTML = xmlDoc.getElementsByTagName("sensor_type")[0].childNodes[0].nodeValue;
		  document.getElementById("location").innerHTML = xmlDoc.getElementsByTagName("location")[0].childNodes[0].nodeValue;
		  document.getElementsByName("id")[0].value = xmlDoc.getElementsByTagName("id")[0].childNodes[0].nodeValue;
		  document.getElementsByName("name")[0].value = xmlDoc.getElementsByTagName("name")[0].childNodes[0].nodeValue;
		  document.getElementsByName("location")[0].value = xmlDoc.getElementsByTagName("location")[0].childNodes[0].nodeValue;
		  document.getElementsByName("sensor_type")[0].value = xmlDoc.getElementsByTagName("sensor_type")[0].childNodes[0].nodeValue;
		  document.getElementsByName("refresh_rate")[0].value = xmlDoc.getElementsByTagName("refresh_rate")[0].childNodes[0].nodeValue;
		  document.getElementsByName("alarm_treshold_min")[0].value = xmlDoc.getElementsByTagName("alarm_treshold_min")[0].childNodes[0].nodeValue;
		  document.getElementsByName("alarm_treshold_max")[0].value = xmlDoc.getElementsByTagName("alarm_treshold_max")[0].childNodes[0].nodeValue;
		  document.getElementsByName("esp32_ip")[0].value = xmlDoc.getElementsByTagName("esp32_ip")[0].childNodes[0].nodeValue;
		  document.getElementsByName("mqtt_ip")[0].value = xmlDoc.getElementsByTagName("mqtt_ip")[0].childNodes[0].nodeValue;
		  document.getElementsByName("log_activ")[0].value = xmlDoc.getElementsByTagName("log_activ")[0].childNodes[0].nodeValue;
		  document.getElementsByName("log_days")[0].value = xmlDoc.getElementsByTagName("log_days")[0].childNodes[0].nodeValue;
		}
		
		function saveXMLDoc() {
		  var xmlDoc;
		  var xmlhttp = new XMLHttpRequest();
		  xmlhttp.open("POST", "file:///C:/Users/Surface/Desktop/esp-monitor-master/components/server_monitor_handler/Example_data_graph/test/test.xml" , true);
		  xmlhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				xmlDoc = saveData(this);
				console.log(xmlDoc);
			}
		  };
		  xmlhttp.send(xmlDoc);
		}
		
		function saveData(xml){
			var xmlDoc = xml.responseXML;
			console.log(xmlDoc);
			xmlDoc.getElementsByTagName("id")[0].childNodes[0].nodeValue = document.getElementsByName("id")[0].value;
			xmlDoc.getElementsByTagName("name")[0].childNodes[0].nodeValue = document.getElementsByName("name")[0].value;
			xmlDoc.getElementsByTagName("location")[0].childNodes[0].nodeValue = document.getElementsByName("location")[0].value;
			xmlDoc.getElementsByTagName("sensor_type")[0].childNodes[0].nodeValue = document.getElementsByName("sensor_type")[0].value;
			xmlDoc.getElementsByTagName("refresh_rate")[0].childNodes[0].nodeValue = document.getElementsByName("refresh_rate")[0].value;
			xmlDoc.getElementsByTagName("alarm_treshold_min")[0].childNodes[0].nodeValue = document.getElementsByName("alarm_treshold_min")[0].value;
			xmlDoc.getElementsByTagName("alarm_treshold_max")[0].childNodes[0].nodeValue = document.getElementsByName("alarm_treshold_max")[0].value;
			xmlDoc.getElementsByTagName("esp32_ip")[0].childNodes[0].nodeValue = document.getElementsByName("esp32_ip")[0].value;
			xmlDoc.getElementsByTagName("mqtt_ip")[0].childNodes[0].nodeValue = document.getElementsByName("mqtt_ip")[0].value;
			xmlDoc.getElementsByTagName("log_activ")[0].childNodes[0].nodeValue = document.getElementsByName("log_activ")[0].value;
			xmlDoc.getElementsByTagName("log_days")[0].childNodes[0].nodeValue = document.getElementsByName("log_days")[0].value;
			console.log(xmlDoc);
			return xmlDoc;
		}
		
		function sendForm(form) {
		  var formData = new FormData(form);

		  var xhr = new XMLHttpRequest();
		  xhr.open('POST', "test.txt", true);
		  xhr.onload = function(e) {};

		  xhr.send(formData);
		  console.log(formData);

		  return false; // Prevent page from submitting.
		}

	</script>
</head>
<body onload="loadXMLDoc(0);">
	<div class="topnav">
		<a class="active" href="index.html">Configuration</a>
		<a href="log.html">Log</a>
		<a href="sensor_data.html">Sensor data</a>
		<div class="info">
			Firmware Version: <strong id="f_version"> %F_VERSION%</strong><br>
			Hardware Version: <strong id="h_version"> %H_VERSION%</strong><br>
			Sensor Type: <strong id="sensor_type"> %S_TYPE%</strong><br>
			Location: <strong id="location"> %S_LOCATION%</strong><br>
		</div>
	</div> 

	<h1>ESP-MONITOR - Configuration</h1>
	<form method="POST">
		<fieldset value="general">
		<legend>General:</legend>
			ID:&nbsp;
			<input type="text" name="id" value="%ID%"><br><br>
			Name:&nbsp;
			<input type="text" name="name" value="%NAME%"><br><br>
			Location:&nbsp;
			<input type="text" name="location" value="%S_LOCATION%"><br><br>
		</fieldset>
		<fieldset value="sensor">
		<legend>Sensor:</legend>
			Sensor type:&nbsp;
			<input type="text" name="sensor_type" value="%SENSOR_TYPE%"> S for siesmic or TH for temperature and humidity<br><br>
			Refresh rate:&nbsp;
			<input type="text" name="refresh_rate" value="%REFRESH_RATE%">s (numbers only)<br><br>
			Alarm threshold min:&nbsp;
			<input type="text" name="alarm_treshold_min" value="%ALARM_MIN%"> (numbers only)<br><br>
			Alarm threshold max:&nbsp;
			<input type="text" name="alarm_treshold_max" value="%ALARM_MAX%"> (numbers only)<br><br>
		</fieldset>
		<fieldset value="network">
		<legend>Network:</legend>
			ESP32 IP:&nbsp;
			<input type="text" name="esp32_ip" value="%ESP32_IP%"> <br><br>
			MQTT Server IP:&nbsp;
			<input type="text" name="mqtt_ip" value="%MQTT_IP%"> <br><br>
		</fieldset>
		<fieldset value="data_Logging">
		<legend>Data Logging:</legend>
			<input type="text" name="log_activ" value="%LOG_ACTIV%"> Y or N<br><br>
			Maximum days in memory:&nbsp;
			<input type="text" name="log_days" value="%LOG_DAYS%"> <br><br>
		</fieldset>
		<br>
		<input type="button" onclick="saveXMLDoc();" value="SaveXML">
		<input type="submit" onclick="return sendForm(this.form);" value="Save">&nbsp;&nbsp; <input type="reset">
	</form> 


</body>
</html>