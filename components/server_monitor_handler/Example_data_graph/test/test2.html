<!DOCTYPE html>
<html>
<head>
	<title>ESP-MONITOR - Configuration</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="icon" href="data:,">
	<link rel="stylesheet" type="text/css" href="style.css">
	<script>
		function downloadData(contentType,data,filename){
			var link=document.createElement("A");
			link.setAttribute("href",encodeURI("data:"+contentType+","+data));
			link.setAttribute("style","display:none");
			link.setAttribute("download",filename);
			document.body.appendChild(link); //needed for firefox
			console.log(link.outerHTML);
			link.click();
			setTimeout(function(){document.body.removeChild(link);},1000);
		}

		function fromToXml(form){
			var xmldata=['<?xml version="1.0"?>'];
			xmldata.push("<form>");
			var inputs=form.elements;
			for(var i=0;i<inputs.length;i++){
				if(inputs[i].tagName=="fieldset"){
					var el=document.createElement(inputs[i].value);
					fieldsetToXml(form);
					xmldata.push(el.outerHTML);
				}
			}
			xmldata.push("</form>");
			return xmldata.join("\n");
		}
		
		function fieldsetToXml(form){
			var inputs=form.elements;
			for(var i=0;i<inputs.length;i++){
				xmldata.push("</form>");
				var el=document.createElement("ELEMENT");
				if (inputs[i].name){
					el.setAttribute("name",inputs[i].name);
					el.setAttribute("value",inputs[i].value);
					xmldata.push(el.outerHTML);
				}
			}
		}

		function download(frm){
			var data=fromToXml(frm);
			console.log(data);
			downloadData("text/xml",data,"export.xml");
		}
	</script>
</head>
<body>
	<div class="topnav">
		<a class="active" href="index.html">Configuration</a>
		<a href="log.html">Log</a>
		<a href="sensor_data.html">Sensor data</a>
		<div class="info">
			Firmware Version: <strong> %F_VERSION%</strong><br>
			Hardware Version: <strong> %H_VERSION%</strong><br>
			Sensor Type: <strong> %S_TYPE%</strong><br>
			Location: <strong> %S_LOCATION%</strong><br>
		</div>
	</div> 

	<h1>ESP-MONITOR - Configuration</h1>
	<form>
		<fieldset value="general">
		<legend>General:</legend>
			ID:&nbsp;
			<input type="text" name="id" value="%ID%"><br><br>
			Name:&nbsp;
			<input type="text" name="name" value="%NAME%"><br><br>
			Location:&nbsp;
			<input type="text" name="location" value="%S_LOCATION%"><br><br>
		</fieldset>
		<fieldset value="sensor">
		<legend>Sensor:</legend>
			Sensor type:&nbsp;
			<input type="text" name="sensor_type" value="%SENSOR_TYPE%"> S for siesmic or TH for temperature and humidity<br><br>
			Refresh rate:&nbsp;
			<input type="text" name="refresh_rate" value="%REFRESH_RATE%">s (numbers only)<br><br>
			Alarm threshold min:&nbsp;
			<input type="text" name="alarm_treshold_min" value="%ALARM_MIN%"> (numbers only)<br><br>
			Alarm threshold max:&nbsp;
			<input type="text" name="alarm_treshold_max" value="%ALARM_MAX%"> (numbers only)<br><br>
		</fieldset>
		<fieldset value="network">
		<legend>Network:</legend>
			ESP32 IP:&nbsp;
			<input type="text" name="esp32_ip" value="%ESP32_IP%"> <br><br>
			MQTT Server IP:&nbsp;
			<input type="text" name="mqtt_ip" value="%MQTT_IP%"> <br><br>
		</fieldset>
		<fieldset value="data_Logging">
		<legend>Data Logging:</legend>
			<input type="text" name="log_activ" value="%LOG_ACTIV%"> Y or N<br><br>
			Maximum days in memory:&nbsp;
			<input type="text" name="log_days" value="%LOG_DAYS%"> <br><br>
		</fieldset>
		<br>
		<input type="submit" onclick="download(this.form)" value="Save">&nbsp;&nbsp; <input type="reset">
	</form> 


</body>
</html>